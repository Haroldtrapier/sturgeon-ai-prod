generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                String             @id @default(cuid())
  email             String             @unique
  username          String?            @unique
  firstName         String?
  lastName          String?
  profilePictureUrl String?
  oauthProvider     String?
  oauthId           String?
  isActive          Boolean            @default(true)
  emailVerified     Boolean            @default(false)
  subscriptionPlan  String             @default("free")
  credits           Int                @default(100)
  createdAt         DateTime           @default(now())
  updatedAt         DateTime           @updatedAt
  deletedAt         DateTime?
  savedOpportunities SavedOpportunity[]

  @@index([email])
  @@index([oauthProvider, oauthId])
}

model SavedOpportunity {
  id         String   @id @default(cuid())
  userId     String
  source     String   @default("manual")
  externalId String?
  title      String   @default("Untitled")
  agency     String?
  status     String   @default("watchlist")
  metadata   Json     @default("{}")
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([source])
  @@index([status])
}
